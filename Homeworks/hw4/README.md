# Учебная Виртуальная Машина (УВМ): Ассемблер и Интерпретатор

## Описание проекта
Этот проект реализует учебную виртуальную машину (УВМ), включающую ассемблер и интерпретатор для работы со стековой архитектурой. УВМ предназначена для выполнения низкоуровневых операций над данными в памяти и на стеке.

## Основные компоненты
- `assembler.py` — преобразует программу на языке ассемблера в бинарный код
- `interpreter.py` — выполняет бинарный код, управляя стеком и памятью
- `test_assembler_interpreter.py` — тесты для проверки работы ассемблера и интерпретатора

## Система команд УВМ

### LOAD_CONST (A = 154, 0x9A)
- **Описание**: Загрузка константы на стек
- **Формат**: `LOAD_CONST value`
- **Размер**: 5 байт (1 байт код операции + 4 байта значение)
- **Пример**: `LOAD_CONST 886` → `0x9A 0x76 0x03 0x00 0x00`

### READ_MEM (A = 216, 0xD8)
- **Описание**: Чтение значения из памяти на стек
- **Формат**: `READ_MEM address`
- **Размер**: 5 байт (1 байт код операции + 4 байта адрес)
- **Пример**: `READ_MEM 278` → `0xD8 0x16 0x01 0x00 0x00`

### WRITE_MEM (A = 142, 0x8E)
- **Описание**: Запись значения со стека в память
- **Формат**: `WRITE_MEM address`
- **Размер**: 5 байт (1 байт код операции + 4 байта адрес)
- **Пример**: `WRITE_MEM 527` → `0x8E 0x0F 0x02 0x00 0x00`

### SHIFT_LEFT (A = 75, 0x4B)
- **Описание**: Побитовый сдвиг влево значения на стеке
- **Формат**: `SHIFT_LEFT value`
- **Размер**: 5 байт (1 байт код операции + 4 байта значение)
- **Пример**: `SHIFT_LEFT 683` → `0x4B 0xAB 0x02 0x00 0x00`

## Как использовать

### 1. Создание программы
Создайте файл с расширением `.asm`, содержащий команды УВМ. Например:
```asm
LOAD_CONST 1
WRITE_MEM 0
LOAD_CONST 2
WRITE_MEM 1
READ_MEM 0
SHIFT_LEFT 1
WRITE_MEM 0
```

### 2. Ассемблирование
```bash
python assembler.py program.asm output.bin log.xml
```
Эта команда создаст:
- `output.bin` - бинарный файл с машинным кодом
- `log.xml` - лог работы ассемблера

### 3. Выполнение
```bash
python interpreter.py output.bin result.xml 0-5
```
Где:
- `output.bin` - входной бинарный файл
- `result.xml` - файл с результатами работы
- `0-5` - диапазон памяти для вывода результатов

### 4. Тестирование
```bash
python -m pytest test_assembler_interpreter.py -v
```

## Формат бинарного файла
Каждая команда в бинарном файле занимает 5 байт:
- Байт 0: код операции (A)
- Байты 1-4: операнд (B), записанный в little-endian формате

## Особенности реализации
- Стековая архитектура: все операции выполняются над данными на стеке
- Память размером 1024 ячейки
- Поддержка XML-форматирования для логов и результатов
- Подробная диагностика ошибок

## Зависимости
- Python 3.x
- pytest (для запуска тестов)
