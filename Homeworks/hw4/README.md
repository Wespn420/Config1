# Задание 4

# Учебная Виртуальная Машина (УВМ)

## Описание проекта
Этот проект реализует учебную виртуальную машину (УВМ), предназначенную для изучения основ работы ассемблера и интерпретатора. УВМ использует стековую архитектуру для выполнения низкоуровневых операций, что делает её отличным инструментом для понимания базовых принципов работы компьютера.

## Основные компоненты

### 1. Ассемблер (`assembler.py`)
- Преобразует программу с ассемблерного языка в бинарный код
- Генерирует XML-лог процесса ассемблирования
- Поддерживает базовый набор инструкций
- Обеспечивает контроль ошибок и валидацию входных данных

### 2. Интерпретатор (`interpreter.py`)
- Выполняет бинарный код, сгенерированный ассемблером
- Управляет стеком и памятью виртуальной машины
- Ведет подробный лог выполнения команд
- Сохраняет результаты в XML-формате

### 3. Тесты (`test_assembler_interpreter.py`)
- Проверяет корректность работы ассемблера и интерпретатора
- Включает тесты для всех поддерживаемых инструкций
- Тестирует обработку граничных случаев
- Проверяет форматы выходных файлов

## Архитектура

- Стековая архитектура
- Память: 1024 ячейки
- Порядок байт: little-endian
- 5-байтовый формат инструкций (1 байт опкод + 4 байта операнд)

## Набор команд

1. `LOAD_CONST` (0x9A)
   - Загружает константу на стек
   - Формат: `LOAD_CONST <value>`
   - Пример: `LOAD_CONST 42`

2. `READ_MEM` (0xD8)
   - Читает значение из памяти в стек
   - Формат: `READ_MEM <address>`
   - Пример: `READ_MEM 10`

3. `WRITE_MEM` (0x8E)
   - Записывает значение со стека в память
   - Формат: `WRITE_MEM <address>`
   - Пример: `WRITE_MEM 20`

4. `SHIFT_LEFT` (0x4B)
   - Битовый сдвиг влево значения на стеке
   - Формат: `SHIFT_LEFT <shift_amount>`
   - Пример: `SHIFT_LEFT 1`

## Использование

### Ассемблер

```bash
python assembler.py <input_file> <binary_file> <log_file>
```

- `input_file`: Файл с исходным кодом на ассемблере
- `binary_file`: Выходной бинарный файл
- `log_file`: XML-файл с логом ассемблирования

### Интерпретатор

```bash
python interpreter.py <binary_file> <result_file> <memory_range>
```

- `binary_file`: Входной бинарный файл
- `result_file`: XML-файл с результатами
- `memory_range`: Диапазон памяти для вывода (формат: start-end)

## Форматы файлов

### Лог ассемблера (XML)
```xml
<?xml version='1.0' encoding='utf-8'?>
<log>
    <instruction command="LOAD_CONST" operand="42" />
    <instruction command="WRITE_MEM" operand="0" />
</log>
```

### Результат интерпретатора (XML)
```xml
<?xml version='1.0' encoding='utf-8'?>
<result>
    <memory address="0" value="42" />
    <memory address="1" value="0" />
</result>
```

## Пример программы

```assembly
# Загрузка и сдвиг числа
LOAD_CONST 42    # Загружаем 42 на стек
WRITE_MEM 0     # Сохраняем в память по адресу 0
READ_MEM 0      # Читаем обратно на стек
SHIFT_LEFT 1    # Сдвигаем влево на 1 (умножаем на 2)
```

## Тестирование

Для запуска тестов используйте:

```bash
python -m pytest test_assembler_interpreter.py -v
```

Тесты включают:
- Проверку форматов инструкций
- Тестирование векторных операций
- Проверку корректности работы стека и памяти

## Зависимости

- Python 3.x
- pytest (для тестирования)
